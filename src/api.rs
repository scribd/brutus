///
/// The API module contains all the REST APIs which brutus provides
///
use std::collections::HashMap;

use crate::fusion::Fusion;
use crate::index::{
    hora_vector_index::HoraVectorIndex, tantivy_text_index::TantivyTextIndex, Index, SearchError,
    SearchResult,
};
use crate::{dal::*, fusion};

use async_std::prelude::*;
use async_std::task::{spawn, JoinHandle};
use serde::{Deserialize, Serialize};
use tide::{Body, Request, Server};
use tracing::log::*;
use tracing::{event, info_span, Level};

/// Main handler for all the API routes
///
/// returns the API server which can be nsted under the main application
pub fn routes() -> tide::Result<Server<State>> {
    let mut app = tide::with_state(State::from_env()?);

    app.at("/search/:doc_id/vector").post(vector_search);
    app.at("/search/:doc_id/relevance").post(relevance_search);
    app.at("/search/:doc_id/hybrid").post(hybrid_search);

    debug!("Registered API routes: {app:?}");
    Ok(app)
}

#[derive(Debug, Default, Deserialize, PartialEq, Serialize)]
pub struct VectorSearchRequest {
    query: Vec<f64>,
}

#[derive(Debug, Default, Deserialize, PartialEq, Serialize)]
pub struct RelevanceSearchRequest {
    query: String,
}

#[derive(Debug, Default, Deserialize, PartialEq, Serialize)]
pub struct HybridSearchRequest {
    query: String,
    vector: Vec<f64>,
}

///
/// POST /relSearch
///
pub async fn hybrid_search(mut req: Request<State>) -> tide::Result<Body> {
    let span = info_span!("hybrid_search");
    let _guard = span.enter();
    let start = std::time::Instant::now();

    let request: HybridSearchRequest = req.body_json().await?;
    let doc_id = req.param("doc_id")?;

    let doc = req
        .state()
        .fetch_doc(format!("{doc_id}/v1.parquet"))
        .await?;
    event!(Level::INFO, elapsed=?start.elapsed(), "loaded parquet file");

    // todo infer number of dimensions from the first chunk
    const DIMENSION: usize = 1024;
    let mut vector_search = HoraVectorIndex::new(DIMENSION);
    let mut text_search = TantivyTextIndex::new();

    let _: Vec<_> = doc
        .chunks
        .iter()
        .map(|chunk| {
            let _ = text_search.add(chunk);
            let _ = vector_search.add(chunk);
            ()
        })
        .collect();

    event!(Level::INFO, elapsed=?start.elapsed(), "chunks added to text and vector index");

    // Fetch this outside of the task spawning to avoid a move
    let chunk_num = doc.chunks.len();

    let text: JoinHandle<Result<Vec<SearchResult>, SearchError>> = spawn(async move {
        text_search.build()?;
        let mut txt_result = text_search.search(request.query, chunk_num)?;
        event!(Level::INFO, elapsed=?start.elapsed(), "text search completed");
        Ok(txt_result)
    });

    let vector: JoinHandle<Result<Vec<SearchResult>, SearchError>> = spawn(async move {
        vector_search.build()?;
        let vector_result = vector_search.search(request.vector, chunk_num)?;
        event!(Level::INFO, elapsed=?start.elapsed(), "vector search completed");
        Ok(vector_result)
    });

    //
    // Both are results types, and ? will unpack those errors below
    let (vector_results, text_results) = vector.join(text).await;
    let mut text_results = text_results?;
    let mut vector_results = vector_results?;

    let response = fusion::RankedFusion::merge(&mut text_results, &mut vector_results);

    event!(Level::INFO, elapsed=?start.elapsed(), "scores combined and returning");
    Body::from_json(&response)
}

///
/// POST /relSearch
///
pub async fn relevance_search(mut req: Request<State>) -> tide::Result<Body> {
    let span = info_span!("relevance_search");
    let _guard = span.enter();
    let start = std::time::Instant::now();

    let request: RelevanceSearchRequest = req.body_json().await?;
    let doc_id = req.param("doc_id")?;

    let doc = req
        .state()
        .fetch_doc(format!("{doc_id}/v1.parquet"))
        .await?;
    let mut text_search = TantivyTextIndex::new();
    event!(Level::INFO, elapsed=?start.elapsed(), "loaded parquet file");

    let _: Vec<_> = doc
        .chunks
        .iter()
        .map(|chunk| text_search.add(chunk))
        .collect();
    event!(Level::INFO, elapsed=?start.elapsed(), "chunks added to text search");

    text_search.build()?;
    event!(Level::INFO, elapsed=?start.elapsed(), "additions committed");

    let result = text_search.search(request.query, doc.chunks.len())?;
    event!(Level::INFO, elapsed=?start.elapsed(), "search completed and returning");
    Body::from_json(&result)
}

///
/// POST /vecSearch
///
pub async fn vector_search(mut req: Request<State>) -> tide::Result<Body> {
    let span = info_span!("relevance_search");
    let _guard = span.enter();
    let start = std::time::Instant::now();

    let request: VectorSearchRequest = req.body_json().await?;
    let doc_id = req.param("doc_id")?;

    //todo move this to a common function
    let doc = req
        .state()
        .fetch_doc(format!("{doc_id}/v1.parquet"))
        .await?;
    event!(Level::INFO, elapsed=?start.elapsed(), "loaded parquet file");

    // todo infer number of dimensions from the first chunk
    const DIMENSION: usize = 1024;
    let mut vector_search = HoraVectorIndex::new(DIMENSION);

    let _: Vec<_> = doc
        .chunks
        .iter()
        .map(|chunk| vector_search.add(chunk))
        .collect();
    event!(Level::INFO, elapsed=?start.elapsed(), "chunks added to vector index");

    vector_search.build()?;
    event!(Level::INFO, elapsed=?start.elapsed(), "index built");

    let response = vector_search.search(request.query, doc.chunks.len())?;
    event!(Level::INFO, elapsed=?start.elapsed(), "search completed and returning");

    Body::from_json(&response)
}

#[cfg(feature = "integration")]
#[cfg(test)]
mod integration_tests {
    use super::*;
    use tide_testing::TideTestingExt;

    /// Return a constructed test [tide::Server] of the API
    async fn setup() -> Server<State> {
        crate::test_utils::setup_env();
        super::routes().expect("Failed to get routes")
    }

    #[async_std::test]
    async fn test_relevance_search() -> tide::Result<()> {
        let app = setup().await;

        let _response: serde_json::Value = app
            .post("/search/1106528470000/relevance")
            .body(Body::from_string(r#"{"query" : "rust"}"#.into()))
            .content_type("application/json")
            .recv_json()
            .await
            .expect("Failed to send vector search query");
        Ok(())
    }

    #[async_std::test]
    async fn test_hybrid() -> tide::Result<()> {
        let app = setup().await;
        let request = serde_json::json!({
            "query" : "rust",
            "vector" : vector_query(),
        });

        let response: serde_json::Value = app
            .post("/search/1106528470000/hybrid")
            .body(Body::from_json(&request)?)
            .content_type("application/json")
            .recv_json()
            .await
            .expect("Failed to send vector search query");
        let results = response
            .as_array()
            .expect("The response should be an array");
        assert_ne!(results.len(), 0);
        Ok(())
    }

    #[async_std::test]
    async fn test_vector() -> tide::Result<()> {
        let app = setup().await;
        let request = serde_json::json!({
            "query" : vector_query(),
        });

        let response: serde_json::Value = app
            .post("/search/1106528470000/vector")
            .body(Body::from_json(&request)?)
            .content_type("application/json")
            .recv_json()
            .await
            .expect("Failed to send vector search query");
        let results = response
            .as_array()
            .expect("The response should be an array");
        assert_ne!(results.len(), 0);
        Ok(())
    }

    fn vector_query() -> Vec<f64> {
        vec![
            -0.0013837373,
            0.014532071,
            -0.031620834,
            -0.042951923,
            0.021943994,
            -0.03857792,
            -0.0072140926,
            0.08266915,
            0.05686889,
            -0.006527847,
            0.014769788,
            0.00508776,
            -0.03399117,
            -0.004209671,
            -0.021056859,
            -0.02747439,
            0.0094059305,
            0.043555588,
            -0.009575485,
            -0.0018935875,
            0.02369392,
            -0.026529133,
            -0.045129,
            -0.02412073,
            -0.02771079,
            -0.023870029,
            -0.021696733,
            -0.015521187,
            0.004791873,
            -0.03963811,
            0.00842127,
            0.010520184,
            -0.043721367,
            -0.00894807,
            -0.0119972015,
            0.017450463,
            0.041778557,
            0.04965926,
            -0.042785164,
            0.031021208,
            -0.018112468,
            0.03803278,
            -0.009406481,
            -0.034999277,
            0.013036867,
            0.03237108,
            0.026636187,
            0.0028761076,
            0.007308964,
            0.054300353,
            0.02854662,
            0.027636826,
            -0.0068942523,
            -0.028659124,
            -0.028732734,
            0.052623108,
            -0.04254612,
            -7.379907E-4,
            -0.029559033,
            0.0023708541,
            -0.012728672,
            -0.011603737,
            0.030431114,
            -0.019527197,
            -0.03461373,
            0.021561977,
            0.033284303,
            0.004934098,
            -0.02344387,
            0.019415962,
            -0.052487884,
            0.01389679,
            -0.015610941,
            -0.021739412,
            -0.02031374,
            -0.040124036,
            0.036013253,
            -0.022789264,
            0.030199673,
            -0.022917232,
            0.05027162,
            -0.0015674669,
            0.029351223,
            -0.03081207,
            0.055576935,
            0.058048822,
            0.020939818,
            0.040502895,
            0.0367323,
            0.03173111,
            -0.032199107,
            0.059245765,
            0.033911254,
            -0.010600519,
            -0.028580356,
            -0.011997549,
            0.03717949,
            0.019093363,
            0.023081042,
            -0.0011378784,
            0.007418141,
            -0.028498668,
            0.029487487,
            -0.042030092,
            -0.024486784,
            0.01596996,
            0.038465906,
            0.043510217,
            0.042574268,
            0.0130629875,
            0.021761304,
            0.045621086,
            0.032342684,
            -0.041918766,
            -0.014446339,
            -0.013980529,
            0.028700529,
            -0.035734884,
            -0.011859387,
            0.030848607,
            0.038756285,
            0.06208988,
            -0.014103957,
            -0.018995583,
            0.027902275,
            -0.014568129,
            0.016506325,
            0.04994576,
            -0.008036035,
            0.02144922,
            0.014402063,
            0.022178149,
            -0.009012666,
            0.0020002471,
            -0.027931068,
            -0.036700323,
            -0.048583683,
            -0.0067277877,
            -0.03474926,
            0.017250508,
            -0.025192162,
            0.041944012,
            0.048374355,
            -0.035696335,
            -0.018603757,
            -0.049594156,
            -0.045417756,
            -0.013906925,
            -0.015394427,
            -0.010351147,
            0.002185981,
            -0.02782535,
            -0.010211199,
            0.03304562,
            0.02113492,
            -0.027512636,
            9.2253205E-4,
            0.07965162,
            0.054186884,
            -0.04749395,
            -0.02885861,
            -0.053142246,
            -0.02639108,
            -0.041773506,
            0.00790053,
            -0.012331555,
            0.040476907,
            0.0058174194,
            -0.0038906613,
            -0.014046113,
            -0.02498125,
            -0.052404474,
            0.030566685,
            -0.05788605,
            -0.033952016,
            0.009993876,
            0.050863866,
            0.013855914,
            0.015417483,
            -0.022332253,
            0.018178416,
            0.05209956,
            0.0308673,
            -0.024199193,
            -0.029339759,
            0.021813177,
            0.012905223,
            0.033595752,
            0.025126776,
            0.034720175,
            0.033770256,
            -0.035449293,
            0.0015949211,
            0.0169161,
            -0.04185001,
            0.026047653,
            0.036888927,
            0.0418724,
            -0.026681826,
            -0.010960353,
            -0.006282102,
            0.022717271,
            -0.04976276,
            0.044174213,
            0.021389106,
            -0.04045143,
            -0.013475418,
            -0.014186487,
            0.01621034,
            -0.048108447,
            -0.070571475,
            -0.04217431,
            0.032508638,
            0.010000398,
            -0.03648713,
            -0.016085068,
            -0.023440778,
            -0.031753004,
            0.029574467,
            0.0024120465,
            0.020897707,
            0.04634092,
            0.01176914,
            -0.009440629,
            0.014365641,
            0.009398097,
            0.027418735,
            0.038183305,
            0.03545443,
            -0.00358106,
            0.032611836,
            0.046047553,
            -0.059712593,
            -9.497462E-4,
            -0.010319591,
            -0.028931312,
            -0.049928483,
            -0.015763031,
            0.020752436,
            0.020620687,
            -0.042360283,
            -0.019755993,
            0.012795661,
            -0.019252777,
            0.0096481,
            -0.017732814,
            0.02248511,
            -0.045036823,
            0.053947676,
            -0.027945697,
            0.017510938,
            0.020062588,
            -0.038585976,
            -0.025016999,
            0.043896347,
            0.018802963,
            0.036100682,
            -0.016340956,
            -0.024517767,
            -0.013037368,
            0.007200564,
            0.052637976,
            -0.013871632,
            0.04717642,
            0.010445152,
            0.019493928,
            -0.038711127,
            -0.018878909,
            -0.018559001,
            -0.0563016,
            -0.051321603,
            -0.03172404,
            -0.054423258,
            -0.016620869,
            -0.042473625,
            -0.03025954,
            -0.06067349,
            -0.03675435,
            -0.004925929,
            0.011230545,
            -0.0047432063,
            -0.0048817596,
            0.026528765,
            -0.03187541,
            0.010603755,
            -0.007621644,
            0.007917508,
            -0.022178968,
            0.009655436,
            -0.017147196,
            0.03402922,
            -0.025467064,
            0.09666608,
            0.033380944,
            0.0011370198,
            0.05266501,
            -0.04370376,
            -0.10543626,
            0.010208901,
            0.008342837,
            -0.023960894,
            -0.054877777,
            0.020140227,
            0.013825726,
            -0.0061088987,
            -0.04820252,
            0.014506806,
            0.035170604,
            -0.047873564,
            0.026187165,
            0.058851007,
            0.039947834,
            0.029558133,
            -0.022402829,
            -0.024438223,
            9.079618E-4,
            -0.03836962,
            0.012708909,
            -0.02429781,
            0.028113475,
            -0.038619153,
            -0.01438136,
            -0.042496786,
            0.03373883,
            0.017968224,
            0.04066306,
            0.0033080943,
            -0.016131725,
            0.02018921,
            -0.01979192,
            0.022376193,
            -0.019026754,
            0.0054820916,
            0.052064568,
            -0.027498297,
            0.0011240746,
            -0.021924656,
            0.027831495,
            0.046662815,
            -0.0133514395,
            0.033341933,
            -0.017668283,
            -0.043194633,
            0.0011986889,
            0.026356103,
            -0.03069918,
            0.021177055,
            -0.008658165,
            0.016407048,
            0.017535634,
            0.025013193,
            -0.0027573388,
            0.043559827,
            0.03220152,
            -0.031853132,
            0.044585418,
            0.027655514,
            -0.010008923,
            -0.013756781,
            -0.03745976,
            0.038747877,
            0.010741502,
            0.057014618,
            -0.014091548,
            0.018975725,
            -0.022941878,
            -0.007118874,
            -0.019563552,
            -0.036879435,
            -0.04532797,
            0.036258075,
            0.01245405,
            -0.03019876,
            0.003065925,
            0.008876402,
            0.01838445,
            -0.059717584,
            -0.030023847,
            0.019619951,
            -0.033331376,
            -0.04740995,
            -0.030572796,
            -0.0012618625,
            -0.03495324,
            -0.00391451,
            -0.0392336,
            0.20246434,
            0.0031766545,
            0.030847713,
            -0.04854353,
            -0.031248197,
            0.02760829,
            0.00912937,
            0.047369923,
            0.0024472023,
            0.03843054,
            -0.030057242,
            7.2571496E-4,
            0.01779897,
            -0.017326852,
            0.033767216,
            0.0422709,
            0.05154876,
            0.023691397,
            0.03355214,
            -0.023983717,
            0.053684603,
            -0.044395402,
            0.043814592,
            0.026649788,
            -0.04788342,
            -0.02376455,
            -0.023120597,
            0.017112112,
            -0.023283513,
            0.014369435,
            -0.014184679,
            0.013284234,
            -0.026697084,
            -0.0126924645,
            -0.0026546267,
            0.02905956,
            0.028011478,
            -0.056824096,
            0.0024774948,
            -3.5473815E-4,
            -0.043500207,
            -0.013350966,
            -0.054324526,
            0.038886137,
            0.004176264,
            0.022233248,
            0.03960079,
            0.0024902367,
            -0.03600554,
            0.014191959,
            -0.005102785,
            0.018443922,
            -0.021756416,
            -0.038591668,
            -0.011640207,
            -0.05199409,
            -0.0419502,
            -0.058991432,
            -0.020660764,
            0.024174515,
            0.04596959,
            -0.012260807,
            -0.027734995,
            -0.036647454,
            0.016954938,
            0.037639506,
            -0.012110731,
            -0.020879675,
            -0.055946175,
            -0.015836941,
            -0.011992752,
            -0.021910965,
            -0.029470818,
            0.021191284,
            0.016524168,
            -0.057413552,
            -0.020770187,
            0.055651948,
            0.022691565,
            -0.019144082,
            0.036113363,
            -0.024446638,
            -0.024263622,
            0.038000613,
            0.047742475,
            -0.014391989,
            0.03423812,
            0.02237965,
            -0.014390415,
            0.010853217,
            0.01864908,
            0.05274796,
            -0.028427329,
            0.050979674,
            -0.005837236,
            -0.04832029,
            0.0014116328,
            0.018050795,
            -0.021470448,
            -0.03187826,
            -0.01079378,
            0.02209888,
            -0.021205189,
            -0.027824683,
            -0.005223052,
            -0.04859637,
            0.035622217,
            0.040442046,
            0.03623381,
            -0.025318636,
            0.0026351393,
            -0.0037982455,
            0.02737386,
            -0.023353554,
            0.0405542,
            0.03678904,
            0.048902147,
            -0.050697785,
            0.023716658,
            0.0041430965,
            -0.028119905,
            0.04919371,
            -0.04090246,
            0.08104043,
            -0.004002305,
            0.043551475,
            -0.057967097,
            3.2967288E-4,
            0.036058363,
            0.007839088,
            0.032413863,
            -0.03261689,
            -0.04312837,
            0.015329931,
            0.017900959,
            -0.027670864,
            0.07199993,
            -0.040318213,
            0.006496237,
            0.043433342,
            -0.014368286,
            0.036488358,
            -0.033813525,
            -0.0028781393,
            0.018749937,
            0.0015983817,
            -0.045427125,
            -0.051217407,
            -0.023052538,
            -0.02324372,
            -0.0035546538,
            -0.0046708346,
            0.051365707,
            0.01623664,
            -0.033098664,
            -0.07199216,
            0.01792345,
            0.022653038,
            0.016925814,
            -0.014999841,
            -0.039786335,
            -0.020021396,
            0.017652437,
            0.09085388,
            0.04733924,
            0.051509332,
            -0.017470213,
            0.0058672978,
            0.03879056,
            0.0058769775,
            -0.013890378,
            -0.008866962,
            -0.006698795,
            0.015162588,
            0.055775337,
            -0.0347095,
            -0.004012616,
            0.017862247,
            -0.021678207,
            0.0037596896,
            -0.038202293,
            0.017812897,
            0.022658175,
            1.5377364E-4,
            -0.042275175,
            0.013609954,
            0.013379137,
            -0.034028266,
            -0.0063266885,
            -0.007291842,
            -0.04094257,
            0.060741376,
            -0.0022552751,
            0.008818893,
            -0.016542971,
            -6.61839E-4,
            0.041429836,
            0.024967067,
            -0.015082095,
            -0.047115363,
            -0.013308563,
            -0.03968147,
            -0.030811155,
            -0.028047815,
            -0.03712102,
            -0.025939167,
            0.010525478,
            0.004123189,
            0.009073338,
            0.019312788,
            -0.015284098,
            -0.007884884,
            0.03397173,
            0.034418974,
            0.02579708,
            -0.004845025,
            0.033532985,
            0.029958826,
            0.033352368,
            -0.016971124,
            8.4462116E-4,
            0.008911853,
            0.0049410267,
            -0.040000565,
            -0.023946138,
            -0.013605073,
            0.01379455,
            0.01893367,
            3.7152204E-5,
            -0.037130922,
            0.007859458,
            -0.029360633,
            -0.03598175,
            -0.018222474,
            -0.0380275,
            -0.025943454,
            0.037042867,
            0.047724213,
            0.01729236,
            0.0034448327,
            0.040271956,
            -0.024501923,
            0.019797249,
            -0.026647247,
            -0.0032719276,
            0.009447073,
            -0.019170279,
            -0.013998493,
            0.02493176,
            0.014961422,
            0.0161037,
            -0.055219885,
            0.022662085,
            0.024678191,
            -0.0076770317,
            -0.025010463,
            0.020552764,
            -0.016745705,
            -0.082229406,
            -0.03906776,
            0.026698945,
            0.0034211474,
            -0.025600929,
            0.0113332495,
            -0.047692258,
            0.03820532,
            0.036602605,
            -0.021425618,
            -0.015764706,
            -0.03659173,
            0.034918725,
            -0.009706474,
            -0.03721968,
            -0.036509115,
            0.06751445,
            0.05354386,
            -0.026549244,
            -0.015325203,
            4.839448E-4,
            -0.054540902,
            -0.019969177,
            0.0023414725,
            0.010568115,
            0.016002368,
            0.042265058,
            0.041762047,
            -0.018522078,
            0.028340703,
            -0.018745929,
            -0.046149936,
            -0.020263538,
            0.027982261,
            -0.010597104,
            0.011897833,
            -0.015349685,
            -0.0737689,
            -0.05366671,
            -0.03662681,
            -0.019961417,
            -0.016080659,
            0.03382005,
            -0.027676241,
            -0.021057345,
            -0.013248434,
            -0.036583386,
            0.02925306,
            -0.018930683,
            -0.02672634,
            0.03132932,
            0.028770242,
            -0.012891312,
            -0.062369585,
            0.016446946,
            0.03667243,
            -0.009412336,
            -0.01220528,
            0.029678695,
            0.008780539,
            -0.025174312,
            0.044272263,
            -0.053139426,
            -0.02324391,
            -0.015488916,
            -0.015649918,
            0.004924201,
            0.029080296,
            0.056297977,
            0.025667433,
            0.017636226,
            -0.014003749,
            0.036211293,
            0.01637635,
            -0.06499411,
            -0.016163336,
            -0.041214604,
            -0.02307556,
            -0.03627843,
            0.004301171,
            -0.01565337,
            -0.029015591,
            -0.019916667,
            -0.0027330087,
            0.054640032,
            -0.011578715,
            0.044454318,
            -0.023540137,
            -0.007752689,
            0.033157997,
            -0.006248846,
            0.028115446,
            -0.024717383,
            0.038242705,
            -0.028856141,
            -4.377655E-4,
            -0.012469902,
            0.055837322,
            -0.03870697,
            0.023321578,
            0.012826566,
            -0.011953379,
            -0.009794357,
            -0.023218881,
            0.017865214,
            0.01147364,
            -0.05784921,
            0.015294804,
            0.01392902,
            0.02975098,
            -0.027970335,
            0.022853315,
            -0.025141725,
            0.0037979402,
            -0.06954379,
            -0.0066462243,
            -0.045277108,
            0.026293753,
            -0.023597153,
            -0.021988034,
            0.03422694,
            0.010422304,
            0.009946751,
            -0.07266795,
            -0.028556319,
            -0.023977194,
            -0.0031170805,
            -0.045042373,
            -0.030327236,
            0.011753143,
            0.0076171425,
            0.025445167,
            -0.0439906,
            0.03319857,
            -0.03269799,
            -0.0071491934,
            -0.09564183,
            0.008429033,
            -0.0050203744,
            -0.008173426,
            -0.0324186,
            -0.02693988,
            -0.033769798,
            0.00938274,
            0.018019274,
            -0.06069374,
            0.0063506877,
            0.023445752,
            0.022185808,
            -0.009002547,
            -0.018889267,
            0.01181353,
            0.042485867,
            -0.015220495,
            0.013410112,
            0.005313897,
            0.017740695,
            -0.034936782,
            9.647967E-4,
            0.020102495,
            0.023148717,
            0.014630401,
            0.012033668,
            0.0044216327,
            -0.02739013,
            -0.060445588,
            -0.030499415,
            -0.02760286,
            0.010966731,
            0.02275604,
            -0.036621675,
            0.031656675,
            -0.021422932,
            -0.035949543,
            -1.7446895E-4,
            0.022628207,
            -0.014186722,
            0.03350242,
            -0.03878374,
            0.01595727,
            -0.03095489,
            0.04306353,
            -0.003772156,
            -0.01999183,
            0.043569446,
            -0.02775676,
            -0.044719808,
            -0.02584595,
            0.04846951,
            0.07125397,
            0.03553577,
            0.045919362,
            -0.0065745837,
            -0.012309068,
            0.022479355,
            0.05472305,
            0.022745114,
            -0.016863693,
            -0.028905323,
            -0.041080218,
            -0.016897662,
            0.012011968,
            -0.040000774,
            -0.011408972,
            -0.024077145,
            0.018705096,
            0.022115624,
            -0.018846555,
            -0.0035863211,
            0.017772444,
            0.011323699,
            -0.037646215,
            -0.051563423,
            -0.010111453,
            0.015917206,
            9.4935225E-5,
            -0.009093291,
            -0.023881672,
            0.01732247,
            0.031806216,
            -0.010278579,
            0.020540984,
            -0.023585513,
            -0.025163196,
            -0.04631115,
            0.025421461,
            -0.051136795,
            0.015589275,
            0.008970245,
            -0.01930796,
            -0.024992047,
            -0.020856647,
            -0.039560553,
            -0.028104907,
            0.0014139008,
            0.0402718,
            -0.032130055,
            -0.02856242,
            0.008127322,
            0.016676027,
            -6.7244844E-5,
            0.04752877,
            0.046231907,
            -0.034201525,
            0.04966929,
            -0.049301855,
            -0.031844128,
            0.009757607,
            -0.02334386,
            -0.01840529,
            -0.041297752,
            -0.008033951,
            -0.008815676,
            0.001722439,
            0.010395925,
            0.016805882,
            -0.04732048,
            -0.051248137,
            0.039285682,
            -0.023148347,
            0.036771588,
            -0.007815614,
            0.0012005018,
            -0.019805646,
            -0.003815671,
            -0.023943644,
            0.026118584,
            -0.0436099,
            0.02672702,
            6.874998E-4,
            -0.025274554,
            -0.008783155,
            8.657063E-4,
            0.06710175,
            0.011480726,
            0.009836806,
            -0.02115059,
            -0.057521198,
            -0.02029213,
            -0.014260257,
            -0.028271249,
            0.045343336,
            -0.024673143,
            -0.046263043,
            -0.01859303,
            -0.011038962,
            -4.6200884E-4,
            -0.02413202,
            -0.0067012124,
            0.036061093,
            0.013467713,
            0.026958317,
            0.0022596985,
            -0.013487927,
            0.019711984,
            0.022782164,
            -0.02176919,
            0.006070447,
            -0.021680446,
            0.040289667,
            0.007860061,
            -0.025288388,
            0.027671203,
            0.012028689,
            -0.04552824,
            -0.008750873,
            0.00461264,
            0.03825121,
            -0.029294336,
            0.019373765,
            0.014889005,
            -0.005348558,
            0.043071806,
            0.021185858,
            0.022096649,
            -0.0025813498,
            0.02857676,
            0.019386705,
            -0.0030943449,
            0.036121435,
            0.016812783,
            0.04641,
            0.03358564,
            0.002745111,
            -0.050410192,
            0.045468885,
            -0.024416173,
            0.014862601,
            -0.040992618,
            0.034258455,
            0.04385804,
            -0.00875475,
            0.0021077732,
            0.0039431434,
            -0.03973112,
            -0.0025093814,
            0.021501517,
            -0.02393576,
            0.023593297,
            -0.0031258345,
            -0.048063084,
            -0.034966834,
            -0.024349282,
            0.0067227543,
            -0.021738466,
            0.037183315,
            0.049991675,
            -0.0030461303,
            -4.4062987E-4,
            0.027952157,
            0.027347125,
            0.024277035,
            0.038779076,
            -0.028664667,
            -0.010749674,
            0.00903896,
            0.044142716,
            0.040284045,
            -0.014761448,
            -0.0057477476,
            -0.007958703,
            0.038618706,
            -0.025057781,
            0.027291885,
            -0.023587748,
            -0.02096685,
            0.010882213,
            0.016172543,
            0.0036321417,
            0.0274383,
            -0.0050149476,
            -0.008273871,
            0.03338856,
            -0.027289975,
            -1.6545248E-4,
            0.035645727,
            0.016526861,
            -0.018899726,
            -0.021695692,
            0.012036732,
        ]
    }
}
